# knowledge.py - 股市新手村 (V67 K線戰法擴充版)

# --- 原有的名詞解釋 (保留) ---
STOCK_TERMS = {
    "🔰 交易規則與基礎術語": {
        "T+2 交割制度": """
**【定義】**
台股實施「T+2」日交割制度。
若您在 T日 (今天) 買進股票，必須在 T+2 日 (後天) 上午 10 點前，確認銀行交割帳戶內有足夠的款項扣款。

**【實戰風險】**
若 T+2 日帳戶餘額不足，就會發生 **「違約交割」**。
這不僅會嚴重影響個人信用紀錄 (聯徵)，導致未來無法辦信用卡或貸款，嚴重者甚至面臨法律責任與賠償。
""",
        "漲跌停限制 (Limit Up/Down)": """
**【定義】**
台股每日股價漲跌幅限制為參考價的 10%。

**【判讀技巧】**
* **🔴 漲停 (Limit Up)**：買氣極強，只有買單沒有賣單。通常代表主力強勢表態，隔日容易開高，是短線強勢的象徵。
* **🟢 跌停 (Limit Down)**：賣壓極重，只有賣單沒有買單。需小心流動性風險（想賣賣不掉）。
""",
        "試撮 (Pre-market Match)": """
**【定義】**
開盤前 (08:30-09:00) 與收盤前 (13:25-13:30) 的模擬撮合階段，會顯示「試算成交價」。

**【主力陷阱】**
主力常利用試撮掛出「假單」來誤導散戶。例如掛漲停買進，吸引散戶跟單，但在 08:59:59 瞬間抽單，導致開盤不如預期。**切記：試撮價格僅供參考，勿盡信。**
""",
        "ROD / IOC / FOK": """
**【委託種類詳解】**
* **ROD (Rest of Day)**：當日有效單。一般散戶最常用，掛單後直到收盤都有效。
* **IOC (Immediate or Cancel)**：立即成交否則取消。只想買現在的價格，沒買到的部分直接取消，不留單。
* **FOK (Fill or Kill)**：全部成交否則取消。要嘛全買，要嘛一張都不買（通常是大戶使用）。
"""
    },
    "📊 進階技術指標 (Technical)": {
        "K線 (Candlestick)": """
**【定義】**
紀錄股價單日走勢的圖形。包含開盤價、收盤價、最高價、最低價。

**【實戰口訣】**
* **🔴 紅K (陽線)**：收盤 > 開盤。代表多方勝，實體越長，買氣越強。
* **🟢 綠K (陰線)**：收盤 < 開盤。代表空方勝，實體越長，賣壓越重。
* **影線**：上影線代表上方有壓力（有人在賣）；下影線代表下方有支撐（有人在接）。
""",
        "MA 移動平均線 (Moving Average)": """
**【定義】**
過去 N 天收盤價的平均值，代表市場的「平均成本」。

**【關鍵參數】**
* **5日線 (5MA / 週線)**：短線攻擊發起線。強勢股不應跌破此線。
* **20日線 (20MA / 月線)**：波段生命線。多頭趨勢的回檔支撐，跌破代表趨勢轉弱。
* **60日線 (60MA / 季線)**：中長線景氣線。大型股或存股族的重要防守點。
""",
        "成交量 (Volume)": """
**【定義】**
當日該股票成交的總張數。

**【量價關係】**
* **有量才有價**：股價上漲必須伴隨成交量放大 (價漲量增)，代表買氣真實。
* **量縮整理**：股價下跌或盤整時，成交量縮小是好事，代表賣壓減輕。
* **爆量長黑**：高檔爆出巨量且收長黑K，通常是主力出貨的訊號，應儘速離場。
""",
        "KD 隨機指標": """
**【定義】**
由 K 值與 D 值組成，數值介於 0-100，用來判斷股價強弱。

**【應用技巧】**
* **黃金交叉**：K 值由下往上穿過 D 值，視為買進訊號 (低檔 20 附近準確度高)。
* **死亡交叉**：K 值由上往下穿過 D 值，視為賣出訊號 (高檔 80 附近準確度高)。
* **高檔鈍化**：KD 長期維持在 80 以上不下來，代表趨勢極度強勢，這時不應看空，反而可能有大波段。
"""
    },
    "💰 籌碼與主力解密 (Chips)": {
        "三大法人": """
**【定義】**
市場上資金最雄厚的三種機構投資人。
* **外資**：外國機構。資金最大，偏好大型權值股 (如台積電)，操作屬波段性質。
* **投信**：國內基金公司。資金來自散戶募集，偏好中小型股，有季底作帳行情，對中小型飆股影響力大。
* **自營商**：券商自己的投資部門。操作極短線，常做避險，參考價值相對較低。
""",
        "融資融券 (Margin Trading)": """
**【定義】**
信用交易，向券商借錢或借股票。
* **融資 (借錢買股)**：散戶指標。融資餘額過高代表籌碼凌亂，主力不易拉抬，容易有多殺多風險。
* **融券 (借券賣股)**：看空指標。若融券餘額暴增但股價不跌，容易發生「軋空」行情 (主力硬拉股價強迫空頭回補)。
""",
        "籌碼集中度": """
**【定義】**
買方前 15 大券商的買超張數佔總成交量的比例。

**【判讀】**
* **集中度高**：代表籌碼流向少數特定人（主力）手中，股價易漲難跌。
* **集中度低**：代表籌碼分散在散戶手中，股價容易受市場情緒波動。
"""
    },
    "🏢 基本面與財報 (Fundamentals)": {
        "EPS (每股盈餘)": """
**【定義】**
Earnings Per Share。公司每一股賺了多少錢。
**【意義】**
是股價的長期基石。EPS 持續成長的股票，股價長線才有上漲的底氣。
""",
        "本益比 (P/E Ratio)": """
**【定義】**
股價 / EPS。代表投資人願意花多少年回本。

**【應用】**
* **< 10倍**：股價可能被低估，或是該產業正處於衰退中。
* **> 20倍**：市場給予高期待，常見於高成長科技股。
""",
        "MoM / YoY (營收成長率)": """
**【定義】**
* **MoM (Month on Month)**：月增率。跟上個月比，檢視短期動能。
* **YoY (Year on Year)**：年增率。跟去年同月比。

**【實戰】**
YoY 是最重要的指標，因為它排除了淡旺季因素。若一家公司 YoY 連續 3 個月大幅成長 (>20%)，很有可能是下一檔飆股。
"""
    },
    "🐉 股市俚語與心法": {
        "割韭菜": "**定義**：散戶反覆追高殺低，資金不斷縮水，像韭菜一樣被主力收割。",
        "抬轎": "**定義**：你在低點買進，主力或晚進場的人幫你把股價推上去，讓你獲利。",
        "洗盤": "**定義**：主力故意讓股價劇烈震盪，把信心不足的散戶嚇跑，以便在低檔收集籌碼。",
        "畢業": "**定義**：本金賠光，黯然退出股市。",
        "左側交易": "**定義**：在股價下跌時預測底部買進（越跌越買），風險較高，但成本低。",
        "右側交易": "**定義**：在股價打底完成、確認上漲趨勢後買進（追漲），成本稍高但勝率較高。"
    }
}

# --- V67 新增：K線型態教學資料庫 ---
# 資料格式: [開盤, 最高, 最低, 收盤] (台股紅漲綠跌：收>開=紅, 收<開=綠)
KLINE_PATTERNS = {
    "bull": { # 多方型態
        "錘頭線 (Hammer)": {
            "desc": """
            **【型態特徵】**
            出現在下跌趨勢底部。實體很小，**下影線極長**（至少實體2倍），無上影線。
            
            **【多空心理】**
            開盤後空方用力下殺，但低檔買盤湧入，將股價硬生生推回高點。代表**空方力竭，多方開始反擊**。
            
            **【操作建議】**
            見此訊號不可馬上進場，需等待隔日出現**紅K棒**確認止跌，設錘頭低點為停損。
            """,
            "data": [[100, 100, 92, 99]] # 下殺後拉回
        },
        "多頭吞噬 (Bullish Engulfing)": {
            "desc": """
            **【型態特徵】**
            第一根為綠K（跌），第二根為長紅K（漲）。
            **紅K實體完全包覆住綠K實體**。
            
            **【多空心理】**
            原本空方佔優勢，但隔日多方以壓倒性力量開低走高，將昨日賣壓全數吃掉。這是**極強的底部反轉訊號**。
            
            **【操作建議】**
            若伴隨成交量放大，可嘗試進場，以長紅K低點為防守點。
            """,
            "data": [[100, 100, 95, 96], [95, 103, 95, 102]] # 綠K被紅K吞噬
        },
        "晨星 (Morning Star)": {
            "desc": """
            **【型態特徵】**
            由三根K線組成：
            1. 長綠K (跌勢不止)
            2. 跳空低開的小星星 (多空交戰)
            3. 長紅K (多方反攻，收復第一根跌幅一半以上)
            
            **【多空心理】**
            市場在絕望中跳空見底，隨後多方強勢收復失土。是**勝率極高的波段起漲點**。
            
            **【操作建議】**
            第三根紅K出現時為買點。
            """,
            "data": [[105, 105, 95, 96], [94, 95, 93, 94], [96, 104, 96, 103]]
        },
        "紅三兵 (Three White Soldiers)": {
            "desc": """
            **【型態特徵】**
            連續出現三根紅K棒，收盤價一天比一天高，且每日開盤都在前一日實體內。
            
            **【多空心理】**
            代表多頭部隊穩步推進，賣壓被逐日化解，趨勢已由空翻多。
            
            **【操作建議】**
            趨勢確立，拉回均線不破皆是買點。
            """,
            "data": [[90, 93, 90, 92], [92, 95, 91, 94], [94, 98, 93, 97]]
        },
        "破底翻 (Spring)": {
            "desc": """
            **【型態特徵】**
            股價跌破前波低點後，迅速在1-2天內拉回並站上前低之上，留長下影線。
            
            **【多空心理】**
            主力故意跌破支撐以誘發散戶停損賣壓 (洗盤)，隨後迅速拉起。
            
            **【操作建議】**
            這是標準的**假跌破、真拉抬**，確認站回支撐後是大膽買點。
            """,
            "data": [[100, 102, 98, 100], [100, 100, 90, 92], [92, 105, 92, 103]]
        }
    },
    "bear": { # 空方型態
        "上吊線 (Hanging Man)": {
            "desc": """
            **【型態特徵】**
            形狀與錘頭線一樣 (小實體、長下影線)，但出現在**高檔上漲趨勢中**。
            
            **【多空心理】**
            高檔出現下殺，雖然收盤拉回，但顯示**主力已開始在高檔出貨**，多方力道轉弱，是危險訊號。
            
            **【操作建議】**
            若隔日收綠K確認，應立即減碼或離場。
            """,
            "data": [[50, 55, 50, 54], [54, 58, 54, 57], [57, 57, 50, 56]] # 高檔出現長下影
        },
        "空頭吞噬 (Bearish Engulfing)": {
            "desc": """
            **【型態特徵】**
            高檔出現一根紅K，隔日出現一根更長的綠K，**綠K實體完全包覆紅K**。
            
            **【多空心理】**
            多方攻勢耗盡，空方以壓倒性力量反撲，將昨日買盤全數套牢。是**強力頭部訊號**。
            
            **【操作建議】**
            逃命波！不要留戀，跌破綠K低點確認趨勢反轉。
            """,
            "data": [[100, 102, 98, 101], [102, 103, 95, 96]]
        },
        "夜星 (Evening Star)": {
            "desc": """
            **【型態特徵】**
            與晨星相反，出現在高檔：
            1. 長紅K (多頭最後衝刺)
            2. 跳空高開的小星星 (高檔迷航)
            3. 長綠K (空方正式接管)
            
            **【多空心理】**
            股價創新高後無力續攻，隨後重挫，形成孤島反轉。
            
            **【操作建議】**
            第三根綠K確認成型時，是最後逃生門。
            """,
            "data": [[95, 102, 95, 101], [103, 104, 102, 103], [102, 102, 92, 93]]
        },
        "黑三鴉 (Three Black Crows)": {
            "desc": """
            **【型態特徵】**
            高檔連續出現三根綠K棒，收盤價一天比一天低。
            
            **【多空心理】**
            主力連續倒貨，買盤完全潰散，股價如自由落體般下跌。
            
            **【操作建議】**
            趨勢已轉空，反彈皆是空點，切勿隨意接刀。
            """,
            "data": [[105, 105, 100, 102], [102, 102, 96, 98], [98, 98, 92, 94]]
        },
        "流星線 (Shooting Star)": {
            "desc": """
            **【型態特徵】**
            出現在高檔。實體很小，**上影線極長**（至少實體2倍），無下影線。
            
            **【多空心理】**
            開盤多方試圖攻擊，但遭到空方強烈打壓，收盤被壓回低點。代表**上方壓力極大**，有人在這種價位大量倒貨。
            
            **【操作建議】**
            見此訊號為短線警戒，若隔日無法越過上影線高點，建議獲利了結。
            """,
            "data": [[100, 110, 100, 101]] # 衝高後被打回
        }
    }
}

# --- 策略詳細說明 ---
STRATEGY_DESC = """
### 🤖 AI V62 高勝率策略邏輯解密

**1. ⚡ 強力當沖 (Power DayTrade)**
* **核心哲學**：有量、有價、有波動，才適合當沖。
* **篩選公式**：
    * `今日量 > 昨日量` (爆量攻擊)
    * `股價 > 開盤價` (紅K實體)
    * `股價 > 5日均線` (短線趨勢強)
    * `振幅 > 2%` (波動夠大才有價差賺)
* **操作建議**：嚴守紀律，收盤前必須平倉，絕不留倉過夜。

**2. 📈 穩健短線 (Steady Swing)**
* **核心哲學**：買在多頭排列的起漲點或回檔支撐點。
* **篩選公式**：
    * `5日均線 > 20日均線` (黃金交叉)
    * `股價 > 20日均線` (站穩月線)
    * `50 < RSI < 75` (動能強勁但未過熱)
* **操作建議**：沿著 5日線或 10日線操作，跌破月線停損。

**3. 🐢 長線安穩 (Safe Long)**
* **核心哲學**：價值投資，買在長線保護短線的安全區域。
* **篩選公式**：
    * `股價 > 60日均線(季線)` (多頭趨勢確認)
    * `季線乖離率` 介於 -5% 至 10% (避免追高，買在回檔整理時)
* **操作建議**：分批佈局，不看短線波動，以季線為防守點。

**4. 🏆 熱門強勢 (Hot Top 100)**
* **核心哲學**：跟隨市場人氣，強者恆強。
* **篩選公式**：
    * `成交量 > 1000 張` (過濾流動性差的殭屍股)
    * 依照 `當日漲幅` 與 `成交量` 綜合排序
* **操作建議**：適合積極型投資人，追強勢股，但需嚴設停損 (例如跌破昨日低點)。
"""
